<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>EuroTrans - –†–µ–∑–µ—Ä–≤–∞—Ü–∏—è</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- –ú–û–î–ê–õ–ï–ù –ü–†–û–ó–û–†–ï–¶ (ANIMATION & LAYOUT) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; /* –°–∫—Ä–∏—Ç–æ */
            justify-content: center; align-items: flex-end; /* –ó–∞–ø–æ—á–≤–∞ –æ—Ç–¥–æ–ª—É */
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 20px 20px 0 0; /* –ó–∞–æ–±–ª–µ–Ω–æ —Å–∞–º–æ –≥–æ—Ä–µ */
            width: 100%;
            max-width: 500px;
            text-align: center;
            position: relative;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
            
            /* –ü–ª–∞–≤–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—è –æ—Ç–¥–æ–ª—É */
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        /* --- MERCEDES V-CLASS –î–ò–ó–ê–ô–ù --- */
        .v-class-body {
            background: #e5e7eb; /* –ò–Ω—Ç–µ—Ä–∏–æ—Ä */
            border: 4px solid #1f2937; /* –¢—ä–º–µ–Ω –∫–æ—Ä–ø—É—Å */
            border-radius: 40px 40px 15px 15px; /* –§–æ—Ä–º–∞ –Ω–∞ –≤–∞–Ω */
            padding: 60px 25px 30px 25px;
            margin: 20px auto;
            width: 200px; /* –ü–æ-—Ç–µ—Å–µ–Ω –∏ –¥—ä–ª—ä–≥ */
            min-height: 400px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }

        /* –ü—Ä–µ–¥–Ω–æ —Å—Ç—ä–∫–ª–æ (V-Class style) */
        .v-class-body::before {
            content: ''; position: absolute; top: 15px; left: 20px; right: 20px; height: 35px;
            background: linear-gradient(180deg, #374151 0%, #111827 100%);
            border-radius: 15px 15px 5px 5px;
            box-shadow: inset 0 2px 5px rgba(255,255,255,0.2);
        }

        /* –°—Ç—Ä–∞–Ω–∏—á–Ω–∏ –æ–≥–ª–µ–¥–∞–ª–∞ */
        .v-class-body::after {
            content: ''; position: absolute; top: 30px; left: -12px; width: 228px; height: 10px;
            background: transparent;
            border-left: 8px solid #1f2937; border-right: 8px solid #1f2937;
            border-radius: 5px;
        }

        .seat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px; /* –ü–æ–≤–µ—á–µ –º—è—Å—Ç–æ –∑–∞ –∫—Ä–∞–∫–∞—Ç–∞ */
        }
        
        .seat-row.middle-row {
            justify-content: space-between;
            gap: 10px;
        }

        /* –°—Ç–∏–ª –Ω–∞ —Å–µ–¥–∞–ª–∫–∞—Ç–∞ - –ö–æ–∂–µ–Ω–∞ –≤–∏–∑–∏—è */
        .seat {
            width: 45px; height: 50px; /* –ü—Ä–æ–¥—ä–ª–≥–æ–≤–∞—Ç–∏ —Å–µ–¥–∞–ª–∫–∏ */
            background: linear-gradient(180deg, #fff 0%, #f3f4f6 100%);
            border: 1px solid #d1d5db;
            border-radius: 8px 8px 12px 12px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer;
            font-weight: bold; color: #4b5563;
            transition: 0.2s;
            position: relative;
            box-shadow: 0 4px 0 #e5e7eb;
        }

        /* –ü–æ–¥–≥–ª–∞–≤–Ω–∏–∫ */
        .seat::before {
            content: ''; position: absolute; top: -8px; width: 30px; height: 6px;
            background: #d1d5db; border-radius: 4px;
        }
        
        .seat:active { transform: translateY(3px); box-shadow: 0 1px 0 #e5e7eb; }

        .seat.selected {
            background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
            color: white; border-color: #1d4ed8;
            box-shadow: 0 4px 0 #1e40af;
        }
        .seat.selected::before { background: #93c5fd; }

        .seat.taken {
            background: #fee2e2; color: #ef4444; border-color: #fca5a5;
            cursor: not-allowed; opacity: 0.6; box-shadow: none;
        }
        .seat.taken::before { background: #fca5a5; }

        .seat.driver {
            background: #374151; color: #9ca3af; border-color: #1f2937;
            cursor: default; box-shadow: none;
        }
        .seat.driver::before { background: #4b5563; }

        .close-modal-btn {
            background: #f3f4f6; border: none; padding: 10px 20px;
            border-radius: 20px; cursor: pointer; font-weight: bold; color: #333;
            margin-bottom: 10px;
        }

        /* Cooldown —Å—ä–æ–±—â–µ–Ω–∏–µ */
        .cooldown-alert {
            background: #fee2e2; color: #991b1b; padding: 15px; border-radius: 8px;
            margin-bottom: 15px; border: 1px solid #f87171; text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <div class="nav-container">
            <a href="index.html"><img src="logo.png" alt="EuroTrans Logo" class="logo-img"></a>
            <nav>
                <ul>
                    <li><a href="index.html" id="nav-home">–ù–∞—á–∞–ª–æ</a></li>
                    <li><a href="routes.html" id="nav-routes">–ú–∞—Ä—à—Ä—É—Ç–∏</a></li>
                    <li><a href="schedule.html" id="nav-schedule">–†–∞–∑–ø–∏—Å–∞–Ω–∏–µ</a></li>
                    <li><a href="contact.html" class="active" id="nav-contact">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
                    <li><a href="profile.html" id="nav-profile">–ü—Ä–æ—Ñ–∏–ª</a></li>
                    <li>
                        <select class="lang-select" onchange="changeLanguage(this.value)">
                            <option value="bg">üáßüá¨</option>
                            <option value="en">üá¨üáß</option>
                            <option value="ru">üá∑üá∫</option>
                            <option value="ua">üá∫üá¶</option>
                        </select>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title" id="page-title">–°–≤—ä—Ä–∂–µ—Ç–µ —Å–µ —Å –Ω–∞—Å</h1>
        
        <div class="grid" style="grid-template-columns: 1fr 1.5fr;">
            <div class="card">
                <h3 id="info-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <p>üìû <strong>BG:</strong> +359 888 123 456<br>
                   üìû <strong>MD:</strong> +373 69 123 456</p>
                <br>
                <p>üìß office@eurotrans.com</p>
            </div>

            <div class="content-box">
                <h2 id="form-title">–†–µ–∑–µ—Ä–≤–∞—Ü–∏—è –Ω–∞ –º—è—Å—Ç–æ</h2>
                
                <div id="cooldown-box" class="cooldown-alert">
                    ‚è≥ <strong id="wait-msg-strong">–ú–æ–ª—è –∏–∑—á–∞–∫–∞–π—Ç–µ!</strong> <br>
                    –ú–æ–∂–µ—Ç–µ –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç–µ –Ω–æ–≤–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è —Å–ª–µ–¥ <span id="timer-display">--</span> –º–∏–Ω.
                </div>

                <form id="booking-form">
                    
                    <div style="position: absolute; left: -9999px; top: -9999px;">
                        <input type="text" id="website_check" name="website_check" tabindex="-1" autocomplete="off">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="name" id="lbl-name">–ò–º–µ –∏ –§–∞–º–∏–ª–∏—è</label>
                        <input type="text" id="name" style="width: 100%;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="email" id="lbl-email">Email (–∑–∞ –±–∏–ª–µ—Ç)</label>
                        <input type="email" id="email" style="width: 100%;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="phone" id="lbl-phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="text" id="phone" style="width: 100%;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="route" id="lbl-route">–ú–∞—Ä—à—Ä—É—Ç</label>
                        <select id="route" style="width: 100%;" onchange="initDates()">
                            <option value="sofia-moldova" id="opt-sofia-moldova">–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞ (–ü–µ—Ç—ä–∫)</option>
                            <option value="moldova-sofia" id="opt-moldova-sofia">–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è (–ù–µ–¥–µ–ª—è)</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="travel-date" id="lbl-date">–î–∞—Ç–∞ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ</label>
                        <select id="travel-date" style="width: 100%;"></select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="message" id="lbl-message">–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
                        <textarea id="message" rows="2" style="width: 100%;"></textarea>
                    </div>

                    <button type="button" onclick="openSeatMap()" class="btn" style="width: 100%;" id="btn-choose-seat">üöç –ò–∑–±–µ—Ä–∏ –º—è—Å—Ç–æ</button>
                </form>
            </div>
        </div>
    </main>

    <div id="seat-modal" class="modal-overlay" onclick="if(event.target === this) closeSeatMap()">
        <div class="modal-content">
            <button class="close-modal-btn" onclick="closeSeatMap()">üîΩ –°–∫—Ä–∏–π</button>
            <h3 id="modal-title">Mercedes V-Class</h3>
            
            <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 10px; font-size: 0.8em;">
                <span>‚ö™ –°–≤–æ–±–æ–¥–Ω–æ</span>
                <span style="color:#ef4444">üî¥ –ó–∞–µ—Ç–æ</span>
                <span style="color:#2563eb">üîµ –í–∞—à–µ—Ç–æ</span>
            </div>

            <div class="v-class-body">
                <div class="seat-row">
                    <div class="seat driver" title="Driver"><i class="fas fa-steering-wheel"></i></div>
                    <div class="seat" data-seat="1" onclick="selectSeat(1)">1</div>
                </div>

                <div style="height: 30px;"></div>

                <div class="seat-row middle-row">
                    <div class="seat" data-seat="2" onclick="selectSeat(2)">2</div>
                    <div class="seat" data-seat="3" onclick="selectSeat(3)">3</div>
                    <div class="seat" data-seat="4" onclick="selectSeat(4)">4</div>
                </div>

                <div style="height: 30px;"></div>

                <div class="seat-row middle-row">
                    <div class="seat" data-seat="5" onclick="selectSeat(5)">5</div>
                    <div class="seat" data-seat="6" onclick="selectSeat(6)">6</div>
                    <div class="seat" data-seat="7" onclick="selectSeat(7)">7</div>
                </div>
            </div>

            <p id="selected-seat-msg" style="font-weight: bold; min-height: 20px;">...</p>
            <button id="btn-confirm-booking" class="btn" style="width: 100%; background: #059669; margin-bottom: 20px;" onclick="finalizeBooking()" disabled>‚úÖ –ü–æ—Ç–≤—ä—Ä–¥–∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è—Ç–∞</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        const translations = {
            'bg': { 'page-title': '–°–≤—ä—Ä–∂–µ—Ç–µ —Å–µ —Å –Ω–∞—Å', 'info-title': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', 'form-title': '–†–µ–∑–µ—Ä–≤–∞—Ü–∏—è –Ω–∞ –º—è—Å—Ç–æ', 'lbl-name': '–ò–º–µ –∏ –§–∞–º–∏–ª–∏—è', 'lbl-email': 'Email', 'lbl-phone': '–¢–µ–ª–µ—Ñ–æ–Ω', 'lbl-route': '–ú–∞—Ä—à—Ä—É—Ç', 'lbl-date': '–î–∞—Ç–∞ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ', 'lbl-message': '–î–æ–ø. –∏–Ω—Ñ–æ', 'btn-choose-seat': 'üöç –ò–∑–±–µ—Ä–∏ –º—è—Å—Ç–æ', 'opt-sofia-moldova': '–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞ (–ü–µ—Ç—ä–∫)', 'opt-moldova-sofia': '–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è (–ù–µ–¥–µ–ª—è)', 'modal-title': 'Mercedes V-Class', 'btn-confirm': '‚úÖ –ü–æ—Ç–≤—ä—Ä–¥–∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è—Ç–∞', 'msg-seat-selected': '–ò–∑–±—Ä–∞–Ω–æ –º—è—Å—Ç–æ: ', 'msg-select-first': '–ú–æ–ª—è –∏–∑–±–µ—Ä–µ—Ç–µ –º—è—Å—Ç–æ.', 'alert-success': '–†–µ–∑–µ—Ä–≤–∞—Ü–∏—è—Ç–∞ –µ —É—Å–ø–µ—à–Ω–∞!', 'alert-fill-data': '–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!', 'wait-msg-strong': '–ú–æ–ª—è –∏–∑—á–∞–∫–∞–π—Ç–µ!' },
            'en': { 'page-title': 'Contact Us', 'info-title': 'Information', 'form-title': 'Seat Booking', 'lbl-name': 'Full Name', 'lbl-email': 'Email', 'lbl-phone': 'Phone', 'lbl-route': 'Route', 'lbl-date': 'Travel Date', 'lbl-message': 'Add. Info', 'btn-choose-seat': 'üöç Choose Seat', 'opt-sofia-moldova': 'Sofia ‚ûî Moldova (Friday)', 'opt-moldova-sofia': 'Moldova ‚ûî Sofia (Sunday)', 'modal-title': 'Mercedes V-Class', 'btn-confirm': '‚úÖ Confirm Booking', 'msg-seat-selected': 'Selected Seat: ', 'msg-select-first': 'Please select a seat.', 'alert-success': 'Booking Successful!', 'alert-fill-data': 'Please fill all fields!', 'wait-msg-strong': 'Please wait!' },
            'ru': { 'page-title': '–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏', 'info-title': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', 'form-title': '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞', 'lbl-name': '–ò–º—è –∏ –§–∞–º–∏–ª–∏—è', 'lbl-email': 'Email', 'lbl-phone': '–¢–µ–ª–µ—Ñ–æ–Ω', 'lbl-route': '–ú–∞—Ä—à—Ä—É—Ç', 'lbl-date': '–î–∞—Ç–∞', 'lbl-message': '–î–æ–ø. –∏–Ω—Ñ–æ', 'btn-choose-seat': 'üöç –í—ã–±—Ä–∞—Ç—å –º–µ—Å—Ç–æ', 'opt-sofia-moldova': '–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞ (–ü—è—Ç–Ω–∏—Ü–∞)', 'opt-moldova-sofia': '–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è (–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)', 'modal-title': 'Mercedes V-Class', 'btn-confirm': '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å', 'msg-seat-selected': '–í—ã–±—Ä–∞–Ω–æ –º–µ—Å—Ç–æ: ', 'msg-select-first': '–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ.', 'alert-success': '–£—Å–ø–µ—à–Ω–æ!', 'alert-fill-data': '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è!', 'wait-msg-strong': '–ü–æ–¥–æ–∂–¥–∏—Ç–µ!' },
            'ua': { 'page-title': '–ó–≤\'—è–∑–æ–∫', 'info-title': '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è', 'form-title': '–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –º—ñ—Å—Ü—è', 'lbl-name': '–Ü–º\'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ', 'lbl-email': 'Email', 'lbl-phone': '–¢–µ–ª–µ—Ñ–æ–Ω', 'lbl-route': '–ú–∞—Ä—à—Ä—É—Ç', 'lbl-date': '–î–∞—Ç–∞', 'lbl-message': '–î–æ–¥. —ñ–Ω—Ñ–æ', 'btn-choose-seat': 'üöç –û–±—Ä–∞—Ç–∏ –º—ñ—Å—Ü–µ', 'opt-sofia-moldova': '–°–æ—Ñ—ñ—è ‚ûî –ú–æ–ª–¥–æ–≤–∞ (–ü\'—è—Ç–Ω–∏—Ü—è)', 'opt-moldova-sofia': '–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ—ñ—è (–ù–µ–¥—ñ–ª—è)', 'modal-title': 'Mercedes V-Class', 'btn-confirm': '‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏', 'msg-seat-selected': '–û–±—Ä–∞–Ω–µ –º—ñ—Å—Ü–µ: ', 'msg-select-first': '–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ü–µ.', 'alert-success': '–£—Å–ø—ñ—à–Ω–æ!', 'alert-fill-data': '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–æ–ª—è!', 'wait-msg-strong': '–ó–∞—á–µ–∫–∞–π—Ç–µ!' }
        };

        const firebaseConfig = {
            apiKey: "AIzaSyBGEPxa0rGPyByiY8Tp3GaiflGnApQocgU",
            authDomain: "prevozmoldovabulgaria.firebaseapp.com",
            projectId: "prevozmoldovabulgaria",
            storageBucket: "prevozmoldovabulgaria.firebasestorage.app",
            messagingSenderId: "970743272899",
            appId: "1:970743272899:web:c27df38bd186bd7e7a1976",
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentLang = 'bg';
        let selectedSeatNum = null;
        const COOLDOWN_MINUTES = 30;

        window.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('preferredLang') || 'bg';
            changeLanguage(savedLang);
            initDates();
            checkCooldownUI(); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ

            auth.onAuthStateChanged(user => {
                if (user && user.email) document.getElementById('email').value = user.email;
            });
        });

        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            for (let key in t) {
                let el = document.getElementById(key);
                if (el) el.innerText = t[key];
            }
            localStorage.setItem('preferredLang', lang);
            document.querySelectorAll('.lang-select').forEach(sel => sel.value = lang);
            initDates();
        }

        // --- –î–ê–¢–ò (–ü–µ—Ç—ä–∫ / –ù–µ–¥–µ–ª—è) ---
        function getNextDayOfWeek(date, dayOfWeek) {
            const resultDate = new Date(date.getTime());
            resultDate.setDate(date.getDate() + (7 + dayOfWeek - date.getDay()) % 7);
            return resultDate;
        }
        function formatDate(date) {
            let d = date.getDate(), m = date.getMonth() + 1;
            return (d < 10 ? '0'+d : d) + '.' + (m < 10 ? '0'+m : m);
        }

        function initDates() {
            const dateSelect = document.getElementById('travel-date');
            const route = document.getElementById('route').value;
            dateSelect.innerHTML = '';
            
            const today = new Date();
            let targetDay = 5; // –ü–µ—Ç—ä–∫
            if (route === 'moldova-sofia') targetDay = 0; // –ù–µ–¥–µ–ª—è

            let nextDate = getNextDayOfWeek(today, targetDay);
            if (today.getDay() === targetDay && today.getHours() >= 12) {
                nextDate.setDate(nextDate.getDate() + 7);
            }

            for(let i=0; i<4; i++) {
                let dateStr = formatDate(nextDate);
                let opt = new Option(dateStr, dateStr);
                dateSelect.add(opt);
                nextDate.setDate(nextDate.getDate() + 7);
            }
        }

        // --- COOLDOWN LOGIC ---
        function getRemainingCooldown() {
            const lastTime = localStorage.getItem('lastReservationTime');
            if (!lastTime) return 0;
            const diff = (new Date().getTime() - parseInt(lastTime)) / 60000;
            if (diff < COOLDOWN_MINUTES) {
                return Math.ceil(COOLDOWN_MINUTES - diff);
            }
            return 0;
        }

        function checkCooldownUI() {
            const remaining = getRemainingCooldown();
            const box = document.getElementById('cooldown-box');
            const btn = document.getElementById('btn-choose-seat');
            
            if (remaining > 0) {
                box.style.display = 'block';
                document.getElementById('timer-display').innerText = remaining;
                btn.disabled = true;
                btn.innerText = `‚è≥ ${remaining} –º–∏–Ω.`;
                return true;
            } else {
                box.style.display = 'none';
                btn.disabled = false;
                btn.innerText = translations[currentLang]['btn-choose-seat'];
                return false;
            }
        }

        // --- SEAT MAP LOGIC ---

        function openSeatMap() {
            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ cooldown
            if (checkCooldownUI()) return;

            // 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –ø–æ–ª–µ—Ç–∞
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            if(!name || !phone || !email) {
                alert(translations[currentLang]['alert-fill-data']);
                return;
            }

            // 3. –û—Ç–≤–∞—Ä—è–Ω–µ –∏ –ê–Ω–∏–º–∞—Ü–∏—è
            const modal = document.getElementById('seat-modal');
            modal.classList.add('active'); // –ó–∞–¥–µ–π—Å—Ç–≤–∞ CSS –∞–Ω–∏–º–∞—Ü–∏—è—Ç–∞
            
            selectedSeatNum = null;
            updateUISeat();
            loadTakenSeats();
        }

        function closeSeatMap() {
            const modal = document.getElementById('seat-modal');
            modal.classList.remove('active'); // –°–∫—Ä–∏–≤–∞ —Å –∞–Ω–∏–º–∞—Ü–∏—è
        }

        function loadTakenSeats() {
            const date = document.getElementById('travel-date').value;
            const route = document.getElementById('route').value;

            document.querySelectorAll('.seat').forEach(s => {
                if(!s.classList.contains('driver')) {
                    s.className = 'seat';
                }
            });

            db.collection("reservations")
              .where("date", "==", date)
              .where("route", "==", route)
              .get()
              .then((querySnapshot) => {
                  querySnapshot.forEach((doc) => {
                      const data = doc.data();
                      if (data.seatNumber) {
                          const seatEl = document.querySelector(`.seat[data-seat="${data.seatNumber}"]`);
                          if(seatEl) {
                              seatEl.classList.add('taken');
                              seatEl.title = translations[currentLang]['leg-taken'];
                          }
                      }
                  });
              });
        }

        function selectSeat(num) {
            const seatEl = document.querySelector(`.seat[data-seat="${num}"]`);
            if(seatEl.classList.contains('taken')) return;

            document.querySelectorAll('.seat.selected').forEach(s => s.classList.remove('selected'));
            seatEl.classList.add('selected');
            selectedSeatNum = num;
            updateUISeat();
        }

        function updateUISeat() {
            const msgEl = document.getElementById('selected-seat-msg');
            const btn = document.getElementById('btn-confirm-booking');
            const t = translations[currentLang];

            if(selectedSeatNum) {
                msgEl.innerText = t['msg-seat-selected'] + selectedSeatNum;
                btn.disabled = false;
            } else {
                msgEl.innerText = t['msg-select-first'];
                btn.disabled = true;
            }
        }

        function finalizeBooking() {
            if(!selectedSeatNum) return;
            // –ü–æ—Å–ª–µ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ cooldown
            if (checkCooldownUI()) {
                closeSeatMap();
                return;
            }

            const btn = document.getElementById('btn-confirm-booking');
            btn.disabled = true;
            btn.innerText = "...";

            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value.toLowerCase(),
                phone: document.getElementById('phone').value,
                date: document.getElementById('travel-date').value,
                route: document.getElementById('route').value,
                message: document.getElementById('message').value,
                seatNumber: selectedSeatNum,
                time: new Date().toLocaleString(),
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            const user = auth.currentUser;
            if (user) formData.userId = user.uid;

            db.collection("reservations").add(formData)
            .then(function() {
                // –ó–∞–ø–∏—Å–≤–∞–Ω–µ –Ω–∞ –≤—Ä–µ–º–µ—Ç–æ –∑–∞ cooldown
                localStorage.setItem('lastReservationTime', new Date().getTime());
                
                closeSeatMap();
                alert(translations[currentLang]['alert-success']);
                location.reload(); 
            })
            .catch(function(error) {
                alert("Error: " + error.message);
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>