<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>EuroTrans - –ö–æ–Ω—Ç–∞–∫—Ç–∏</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="nav-container">
            <a href="index.html"><img src="logo.png" alt="EuroTrans Logo" class="logo-img"></a>
            <nav>
                <ul>
                    <li><a href="index.html" id="nav-home">–ù–∞—á–∞–ª–æ</a></li>
                    <li><a href="schedule.html" id="nav-schedule">–†–∞–∑–ø–∏—Å–∞–Ω–∏–µ</a></li>
                    <li><a href="routes.html" id="nav-routes">–ú–∞—Ä—à—Ä—É—Ç–∏</a></li>
                    <li><a href="documents.html" id="nav-docs">–î–æ–∫—É–º–µ–Ω—Ç–∏</a></li>
                    <li><a href="fleet.html" id="nav-fleet">–ê–≤—Ç–æ–ø–∞—Ä–∫</a></li>
                    <li><a href="contact.html" class="active" id="nav-contact">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
                    <li>
                        <select class="lang-select" onchange="changeLanguage(this.value)">
                            <option value="bg">üáßüá¨</option>
                            <option value="en">üá¨üáß</option>
                            <option value="ru">üá∑üá∫</option>
                            <option value="ua">üá∫üá¶</option>
                        </select>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title" id="contact-title">–°–≤—ä—Ä–∂–µ—Ç–µ —Å–µ —Å –Ω–∞—Å</h1>
        
        <div class="grid" style="grid-template-columns: 1fr 1.5fr;">
            <div class="card">
                <h3 id="contact-info-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <p id="contact-phones">
                    üìû <strong>BG:</strong> +359 888 123 456<br>
                    üìû <strong>MD:</strong> +373 69 123 456
                </p>
                <br>
                <p>üìß office@eurotrans.com</p>
                <br>
                <p id="contact-address">üìç –û—Ñ–∏—Å –°–æ—Ñ–∏—è: –±—É–ª. –í–∏—Ç–æ—à–∞ 10</p>
            </div>

            <div class="content-box">
                <h2 id="form-title">–†–µ–∑–µ—Ä–≤–∞—Ü–∏—è / –ó–∞–ø–∏—Ç–≤–∞–Ω–µ</h2>
                <form id="booking-form">
                    
                    <div style="margin-bottom: 15px;">
                        <label for="name" style="display:block; margin-bottom:5px;">–ò–º–µ –∏ –§–∞–º–∏–ª–∏—è</label>
                        <input type="text" id="name" name="name" style="width: 100%;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="phone" style="display:block; margin-bottom:5px;">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="text" id="phone" name="phone" style="width: 100%;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="travel-date" style="display:block; margin-bottom:5px;">–î–∞—Ç–∞ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ</label>
                        <select id="travel-date" name="travel-date" style="width: 100%;" onchange="updateRouteBasedOnDate()">
                            </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="route" style="display:block; margin-bottom:5px;">–ú–∞—Ä—à—Ä—É—Ç</label>
                        <select id="route" name="route" style="width: 100%;">
                            <option value="sofia-moldova">–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞</option>
                            <option value="moldova-sofia">–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="pickup-address" style="display:block; margin-bottom:5px;">–ê–¥—Ä–µ—Å –∑–∞ –≤–∑–µ–º–∞–Ω–µ</label>
                        <input type="text" id="pickup-address" name="pickup-address" style="width: 100%;" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∞–¥—Ä–µ—Å–∞ –Ω–∞ –≤–∑–µ–º–∞–Ω–µ" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="message" style="display:block; margin-bottom:5px;">–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
                        <textarea id="message" name="message" rows="4" style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #e5e7eb; background:#f9fafb;"></textarea>
                    </div>

                    <button type="submit" class="btn" style="width: 100%;" id="btn-send">–ò–∑–ø—Ä–∞—Ç–∏</button>
                </form>
            </div>
        </div>
    </main>
    <script src="lang.js"></script>

    <script>
        // --- –õ–û–ì–ò–ö–ê –ó–ê –î–ê–¢–ò–¢–ï ---
        function getNextDayOfWeek(date, dayOfWeek) {
            const resultDate = new Date(date.getTime());
            resultDate.setDate(date.getDate() + (7 + dayOfWeek - date.getDay()) % 7);
            return resultDate;
        }

        function formatDate(date) {
            let d = date.getDate();
            let m = date.getMonth() + 1;
            return (d < 10 ? '0'+d : d) + '.' + (m < 10 ? '0'+m : m);
        }

        window.addEventListener('DOMContentLoaded', () => {
            const dateSelect = document.getElementById('travel-date');
            const routeSelect = document.getElementById('route');
            const today = new Date();

            let nextFriday = getNextDayOfWeek(today, 5);
            if (today.getDay() === 5 && today.getHours() >= 16) {
                nextFriday.setDate(nextFriday.getDate() + 7);
            }

            let nextSunday = getNextDayOfWeek(today, 0);
            if (today.getDay() === 0 && today.getHours() >= 8) {
                nextSunday.setDate(nextSunday.getDate() + 7);
            }

            let optFri = document.createElement('option');
            optFri.value = 'friday';
            optFri.text = `–ü–µ—Ç—ä–∫ (${formatDate(nextFriday)})`;
            dateSelect.add(optFri);

            let optSun = document.createElement('option');
            optSun.value = 'sunday';
            optSun.text = `–ù–µ–¥–µ–ª—è (${formatDate(nextSunday)})`;
            dateSelect.add(optSun);

            const urlParams = new URLSearchParams(window.location.search);
            const dayParam = urlParams.get('day');

            if (dayParam === 'friday') {
                dateSelect.value = 'friday';
            } else if (dayParam === 'sunday') {
                dateSelect.value = 'sunday';
            }

            // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –æ—Ç localStorage (–∏–¥–≤–∞ –æ—Ç routes.html)
            const selectedRoute = localStorage.getItem('selectedRoute');
            if (selectedRoute) {
                // –û–ø—Ä–µ–¥–µ–ª—è–Ω–µ –Ω–∞ –ø–æ—Å–æ–∫–∞—Ç–∞ –æ—Ç selectedRoute
                if (selectedRoute.includes('–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞')) {
                    routeSelect.value = 'sofia-moldova';
                } else if (selectedRoute.includes('–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è')) {
                    routeSelect.value = 'moldova-sofia';
                }
                // –ú–æ–∂–µ–º –¥–∞ –ø–æ–∫–∞–∂–µ–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)
                console.log('–ó–∞—Ä–µ–¥–µ–Ω –º–∞—Ä—à—Ä—É—Ç:', selectedRoute);
            }

            updateRouteBasedOnDate();
        });

        function updateRouteBasedOnDate() {
            const dateSelect = document.getElementById('travel-date');
            const routeSelect = document.getElementById('route');
            const selectedValue = dateSelect.value;

            for (let i = 0; i < routeSelect.options.length; i++) {
                routeSelect.options[i].disabled = false;
                routeSelect.options[i].hidden = false;
            }

            if (selectedValue === 'friday') {
                routeSelect.value = 'sofia-moldova';
                for (let i = 0; i < routeSelect.options.length; i++) {
                    if (routeSelect.options[i].value === 'moldova-sofia') {
                        routeSelect.options[i].disabled = true;
                    }
                }
            } else if (selectedValue === 'sunday') {
                routeSelect.value = 'moldova-sofia';
                for (let i = 0; i < routeSelect.options.length; i++) {
                    if (routeSelect.options[i].value === 'sofia-moldova') {
                        routeSelect.options[i].disabled = true;
                    }
                }
            }
        }
    </script>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        // 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–¢–≤–æ–∏—Ç–µ –¥–∞–Ω–Ω–∏ —Å–∞ –ø–æ–ø—ä–ª–Ω–µ–Ω–∏)
        const firebaseConfig = {
            apiKey: "AIzaSyBGEPxa0rGPyByiY8Tp3GaiflGnApQocgU",
            authDomain: "prevozmoldovabulgaria.firebaseapp.com",
            projectId: "prevozmoldovabulgaria",
            storageBucket: "prevozmoldovabulgaria.firebasestorage.app",
            messagingSenderId: "970743272899",
            appId: "1:970743272899:web:c27df38bd186bd7e7a1976",
            measurementId: "G-2DDCLMRE0W"
        };

        // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            console.log("Firebase –µ —Å–≤—ä—Ä–∑–∞–Ω —É—Å–ø–µ—à–Ω–æ!");

            // 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∞
            const form = document.getElementById('booking-form');
            
            form.addEventListener('submit', function(event) {
                event.preventDefault(); // –°–ø–∏—Ä–∞ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–Ω–µ—Ç–æ

                const btn = document.getElementById('btn-send');
                const originalText = btn.innerText;
                
                btn.innerText = "–ò–∑–ø—Ä–∞—â–∞–Ω–µ...";
                btn.disabled = true;

                // –°—ä–±–∏—Ä–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ
                const formData = {
                    name: document.getElementById('name').value,
                    phone: document.getElementById('phone').value,
                    date: document.getElementById('travel-date').value,
                    route: document.getElementById('route').value,
                    pickupAddress: document.getElementById('pickup-address').value,
                    selectedRoute: localStorage.getItem('selectedRoute') || '–ù–µ –µ –ø–æ—Å–æ—á–µ–Ω',
                    message: document.getElementById('message').value,
                    time: new Date().toLocaleString()
                };

                // –ò–∑–ø—Ä–∞—â–∞–Ω–µ –∫—ä–º Firebase
                db.collection("reservations").add(formData)
                .then(function(docRef) {
                    alert("‚úÖ –†–µ–∑–µ—Ä–≤–∞—Ü–∏—è—Ç–∞ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!");
                    form.reset(); 
                    // –û—Ç—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ selectedRoute –æ—Ç localStorage
                    localStorage.removeItem('selectedRoute');
                    // –ù—É–ª–∏—Ä–∞–Ω–µ –Ω–∞ –¥–∞—Ç–∞—Ç–∞ –∏ –º–∞—Ä—à—Ä—É—Ç–∞ —Å–ª–µ–¥ –∏–∑—á–∏—Å—Ç–≤–∞–Ω–µ
                    updateRouteBasedOnDate(); 
                })
                .catch(function(error) {
                    console.error("Error:", error);
                    alert("‚ùå –ì—Ä–µ—à–∫–∞: " + error.message);
                })
                .finally(function() {
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
            });

        } catch (error) {
            console.error("Firebase Init Error:", error);
            alert("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞: " + error.message);
        }
    </script>

    <button id="scroll-to-top">‚Üë</button>
    <script src="scroll.js"></script>
</body>
</html>