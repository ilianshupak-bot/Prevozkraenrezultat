<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>EuroTrans - –ö–æ–Ω—Ç–∞–∫—Ç–∏</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="nav-container">
            <a href="index.html"><img src="logo.png" alt="EuroTrans Logo" class="logo-img"></a>
            <nav>
                <ul>
                    <li><a href="index.html" id="nav-home">–ù–∞—á–∞–ª–æ</a></li>
                    <li><a href="routes.html" id="nav-routes">–ú–∞—Ä—à—Ä—É—Ç–∏</a></li>
                    <li><a href="schedule.html" id="nav-schedule">–†–∞–∑–ø–∏—Å–∞–Ω–∏–µ</a></li>
                    <li><a href="contact.html" class="active" id="nav-contact">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
                    <li>
                        <select class="lang-select" onchange="changeLanguage(this.value)">
                            <option value="bg">üáßüá¨</option>
                            <option value="en">üá¨üáß</option>
                            <option value="ru">üá∑üá∫</option>
                            <option value="ua">üá∫üá¶</option>
                        </select>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title" id="page-title">–°–≤—ä—Ä–∂–µ—Ç–µ —Å–µ —Å –Ω–∞—Å</h1>
        
        <div class="grid" style="grid-template-columns: 1fr 1.5fr;">
            <div class="card">
                <h3 id="info-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <p>üìû <strong>BG:</strong> +359 87 8272034<br>
                   üìû <strong>MD:</strong> +373 69 123 456</p>
                <br>
                <p>üìß polina_kuneva@gmail.com</p>
            </div>

            <div class="content-box">
                <h2 id="form-title">–†–µ–∑–µ—Ä–≤–∞—Ü–∏—è</h2>
                
                <div id="cooldown-msg" style="display:none; background: #fee2e2; color: #991b1b; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #f87171;">
                    ‚è≥ <strong id="wait-msg-strong">–ú–æ–ª—è –∏–∑—á–∞–∫–∞–π—Ç–µ!</strong> <span id="timer-display">--</span> –º–∏–Ω.
                </div>

                <form id="booking-form">
                    
                    <div style="position: absolute; left: -9999px; top: -9999px;">
                        <input type="text" id="website_check" name="website_check" tabindex="-1" autocomplete="off">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="name" id="lbl-name">–ò–º–µ –∏ –§–∞–º–∏–ª–∏—è</label>
                        <input type="text" id="name" style="width: 100%;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="email" id="lbl-email">Email (–∑–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ)</label>
                        <input type="email" id="email" style="width: 100%;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="phone" id="lbl-phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="text" id="phone" style="width: 100%;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="travel-date" id="lbl-date">–î–∞—Ç–∞ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ</label>
                        <select id="travel-date" style="width: 100%;" onchange="updateRouteBasedOnDate()"></select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="route" id="lbl-route">–ú–∞—Ä—à—Ä—É—Ç</label>
                        <select id="route" style="width: 100%;">
                            <option value="sofia-moldova" id="opt-sofia-moldova">–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞</option>
                            <option value="moldova-sofia" id="opt-moldova-sofia">–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="message" id="lbl-message">–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
                        <textarea id="message" rows="4" style="width: 100%;"></textarea>
                    </div>

                    <button type="submit" class="btn" style="width: 100%;" id="btn-send">–ò–∑–ø—Ä–∞—Ç–∏</button>
                </form>
            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        const translations = {
            'bg': { 'nav-home': '–ù–∞—á–∞–ª–æ', 'nav-routes': '–ú–∞—Ä—à—Ä—É—Ç–∏', 'nav-schedule': '–†–∞–∑–ø–∏—Å–∞–Ω–∏–µ', 'nav-contact': '–ö–æ–Ω—Ç–∞–∫—Ç–∏', 'nav-profile': '–ü—Ä–æ—Ñ–∏–ª', 'page-title': '–°–≤—ä—Ä–∂–µ—Ç–µ —Å–µ —Å –Ω–∞—Å', 'info-title': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', 'form-title': '–†–µ–∑–µ—Ä–≤–∞—Ü–∏—è / –ó–∞–ø–∏—Ç–≤–∞–Ω–µ', 'lbl-name': '–ò–º–µ –∏ –§–∞–º–∏–ª–∏—è', 'lbl-email': 'Email (–∑–∞ –≤—Ä—ä–∑–∫–∞)', 'lbl-phone': '–¢–µ–ª–µ—Ñ–æ–Ω', 'lbl-date': '–î–∞—Ç–∞ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ', 'lbl-route': '–ú–∞—Ä—à—Ä—É—Ç', 'lbl-message': '–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', 'btn-send': '–ò–∑–ø—Ä–∞—Ç–∏', 'opt-sofia-moldova': '–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞', 'opt-moldova-sofia': '–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è', 'day-friday': '–ü–µ—Ç—ä–∫', 'day-sunday': '–ù–µ–¥–µ–ª—è', 'wait-msg-strong': '–ú–æ–ª—è –∏–∑—á–∞–∫–∞–π—Ç–µ!', 'alert-success': '‚úÖ –ó–∞—è–≤–∫–∞—Ç–∞ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'alert-error': '‚ùå –ì—Ä–µ—à–∫–∞: ', 'btn-sending': '–ò–∑–ø—Ä–∞—â–∞–Ω–µ...', 'btn-blocked': 'üö´ –ò–∑—á–∞–∫–∞–π—Ç–µ...' },
            'en': { 'nav-home': 'Home', 'nav-routes': 'Routes', 'nav-schedule': 'Schedule', 'nav-contact': 'Contact', 'nav-profile': 'Profile', 'page-title': 'Contact Us', 'info-title': 'Information', 'form-title': 'Booking / Inquiry', 'lbl-name': 'Full Name', 'lbl-email': 'Email (for contact)', 'lbl-phone': 'Phone Number', 'lbl-date': 'Travel Date', 'lbl-route': 'Route', 'lbl-message': 'Additional Information', 'btn-send': 'Send Request', 'opt-sofia-moldova': 'Sofia ‚ûî Moldova', 'opt-moldova-sofia': 'Moldova ‚ûî Sofia', 'day-friday': 'Friday', 'day-sunday': 'Sunday', 'wait-msg-strong': 'Please wait!', 'alert-success': '‚úÖ Request sent!', 'alert-error': '‚ùå Error: ', 'btn-sending': 'Sending...', 'btn-blocked': 'üö´ Wait...' },
            'ru': { 'nav-home': '–ì–ª–∞–≤–Ω–∞—è', 'nav-routes': '–ú–∞—Ä—à—Ä—É—Ç—ã', 'nav-schedule': '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ', 'nav-contact': '–ö–æ–Ω—Ç–∞–∫—Ç—ã', 'nav-profile': '–ü—Ä–æ—Ñ–∏–ª—å', 'page-title': '–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏', 'info-title': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', 'form-title': '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', 'lbl-name': '–ò–º—è –∏ –§–∞–º–∏–ª–∏—è', 'lbl-email': 'Email (–¥–ª—è —Å–≤—è–∑–∏)', 'lbl-phone': '–¢–µ–ª–µ—Ñ–æ–Ω', 'lbl-date': '–î–∞—Ç–∞ –ø–æ–µ–∑–¥–∫–∏', 'lbl-route': '–ú–∞—Ä—à—Ä—É—Ç', 'lbl-message': '–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', 'btn-send': '–û—Ç–ø—Ä–∞–≤–∏—Ç—å', 'opt-sofia-moldova': '–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞', 'opt-moldova-sofia': '–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è', 'day-friday': '–ü—è—Ç–Ω–∏—Ü–∞', 'day-sunday': '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', 'wait-msg-strong': '–ü–æ–¥–æ–∂–¥–∏—Ç–µ!', 'alert-success': '‚úÖ –£—Å–ø–µ—à–Ω–æ!', 'alert-error': '‚ùå –û—à–∏–±–∫–∞: ', 'btn-sending': '–û—Ç–ø—Ä–∞–≤–∫–∞...', 'btn-blocked': 'üö´ –ñ–¥–∏—Ç–µ...' },
            'ua': { 'nav-home': '–ì–æ–ª–æ–≤–Ω–∞', 'nav-routes': '–ú–∞—Ä—à—Ä—É—Ç–∏', 'nav-schedule': '–†–æ–∑–∫–ª–∞–¥', 'nav-contact': '–ö–æ–Ω—Ç–∞–∫—Ç–∏', 'nav-profile': '–ü—Ä–æ—Ñ—ñ–ª—å', 'page-title': '–ó–≤\'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏', 'info-title': '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è', 'form-title': '–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è', 'lbl-name': '–Ü–º\'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ', 'lbl-email': 'Email (–¥–ª—è –∑–≤\'—è–∑–∫—É)', 'lbl-phone': '–¢–µ–ª–µ—Ñ–æ–Ω', 'lbl-date': '–î–∞—Ç–∞ –ø–æ—ó–∑–¥–∫–∏', 'lbl-route': '–ú–∞—Ä—à—Ä—É—Ç', 'lbl-message': '–î–æ–¥. —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è', 'btn-send': '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏', 'opt-sofia-moldova': '–°–æ—Ñ—ñ—è ‚ûî –ú–æ–ª–¥–æ–≤–∞', 'opt-moldova-sofia': '–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ—ñ—è', 'day-friday': '–ü\'—è—Ç–Ω–∏—Ü—è', 'day-sunday': '–ù–µ–¥—ñ–ª—è', 'wait-msg-strong': '–ó–∞—á–µ–∫–∞–π—Ç–µ!', 'alert-success': '‚úÖ –£—Å–ø—ñ—à–Ω–æ!', 'alert-error': '‚ùå –ü–æ–º–∏–ª–∫–∞: ', 'btn-sending': '–ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è...', 'btn-blocked': 'üö´ –ß–µ–∫–∞–π—Ç–µ...' }
        };

        const firebaseConfig = {
            apiKey: "AIzaSyBGEPxa0rGPyByiY8Tp3GaiflGnApQocgU",
            authDomain: "prevozmoldovabulgaria.firebaseapp.com",
            projectId: "prevozmoldovabulgaria",
            storageBucket: "prevozmoldovabulgaria.firebasestorage.app",
            messagingSenderId: "970743272899",
            appId: "1:970743272899:web:c27df38bd186bd7e7a1976",
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentLang = 'bg';

        window.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('preferredLang') || 'bg';
            changeLanguage(savedLang);
            checkCooldownStatus();
            initDates();

            // –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û –ü–û–ü–™–õ–í–ê–ù–ï –ù–ê –ò–ú–ï–ô–õ –ê–ö–û –ï –õ–û–ì–ù–ê–¢
            auth.onAuthStateChanged(user => {
                if (user && user.email) {
                    document.getElementById('email').value = user.email;
                    // –ú–æ–∂–µ –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–º –ø–æ–ª–µ—Ç–æ —Å–∞–º–æ –∑–∞ —á–µ—Ç–µ–Ω–µ, –∑–∞ –¥–∞ –Ω–µ —Å–±—ä—Ä–∫–∞
                    // document.getElementById('email').readOnly = true; 
                }
            });
        });

        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            for (let key in t) {
                let el = document.getElementById(key);
                if (el) el.innerText = t[key];
            }
            localStorage.setItem('preferredLang', lang);
            document.querySelectorAll('.lang-select').forEach(sel => sel.value = lang);
            initDates();
        }

        // --- –õ–û–ì–ò–ö–ê –ó–ê –ò–ó–ü–†–ê–©–ê–ù–ï ---
        const form = document.getElementById('booking-form');
        const COOLDOWN_MINUTES = 30;

        function checkCooldownStatus() {
            const lastTime = localStorage.getItem('lastReservationTime');
            if (lastTime) {
                const diff = (new Date().getTime() - parseInt(lastTime)) / 60000;
                if (diff < COOLDOWN_MINUTES) {
                    document.getElementById('btn-send').disabled = true;
                    document.getElementById('cooldown-msg').style.display = 'block';
                    document.getElementById('timer-display').innerText = Math.ceil(COOLDOWN_MINUTES - diff);
                    return true;
                }
            }
            return false;
        }

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            if (checkCooldownStatus()) return;
            if (document.getElementById('website_check').value !== "") return;

            const btn = document.getElementById('btn-send');
            const originalText = btn.innerText;
            btn.innerText = translations[currentLang]['btn-sending'];
            btn.disabled = true;

            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value.toLowerCase(), // –í–ê–ñ–ù–û: –ó–∞–ø–∞–∑–≤–∞–º–µ –∏–º–µ–π–ª–∞
                phone: document.getElementById('phone').value,
                date: document.getElementById('travel-date').value,
                route: document.getElementById('route').value,
                message: document.getElementById('message').value,
                time: new Date().toLocaleString(),
                timestamp: firebase.firestore.FieldValue.serverTimestamp() // –ó–∞ –ø–æ–¥—Ä–µ–∂–¥–∞–Ω–µ
            };

            // –î–æ–±–∞–≤—è–º–µ ID –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è, –∞–∫–æ –µ –ª–æ–≥–Ω–∞—Ç
            const user = auth.currentUser;
            if (user) {
                formData.userId = user.uid;
            }

            db.collection("reservations").add(formData)
            .then(function() {
                localStorage.setItem('lastReservationTime', new Date().getTime());
                alert(translations[currentLang]['alert-success']);
                location.reload(); 
            })
            .catch(function(error) {
                alert(translations[currentLang]['alert-error'] + error.message);
                btn.innerText = originalText;
                btn.disabled = false;
            });
        });

        // --- –î–ê–¢–ò ---
        function getNextDayOfWeek(date, dayOfWeek) {
            const resultDate = new Date(date.getTime());
            resultDate.setDate(date.getDate() + (7 + dayOfWeek - date.getDay()) % 7);
            return resultDate;
        }
        function formatDate(date) {
            let d = date.getDate(), m = date.getMonth() + 1;
            return (d < 10 ? '0'+d : d) + '.' + (m < 10 ? '0'+m : m);
        }
        function initDates() {
            const dateSelect = document.getElementById('travel-date');
            const t = translations[currentLang];
            const currentVal = dateSelect.value;
            dateSelect.innerHTML = '';
            
            const today = new Date();
            let nextFriday = getNextDayOfWeek(today, 5);
            if (today.getDay() === 5 && today.getHours() >= 16) nextFriday.setDate(nextFriday.getDate() + 7);
            
            let nextSunday = getNextDayOfWeek(today, 0);
            if (today.getDay() === 0 && today.getHours() >= 8) nextSunday.setDate(nextSunday.getDate() + 7);

            let optFri = new Option(`${t['day-friday']} (${formatDate(nextFriday)})`, 'friday');
            let optSun = new Option(`${t['day-sunday']} (${formatDate(nextSunday)})`, 'sunday');
            
            dateSelect.add(optFri);
            dateSelect.add(optSun);
            if(currentVal) dateSelect.value = currentVal;
            updateRouteBasedOnDate();
        }

        function updateRouteBasedOnDate() {
            const dateSelect = document.getElementById('travel-date');
            const routeSelect = document.getElementById('route');
            const t = translations[currentLang];

            // –†–µ—Å–µ—Ç
            routeSelect.innerHTML = ''; 
            const optSofia = new Option(t['opt-sofia-moldova'], 'sofia-moldova');
            const optMoldova = new Option(t['opt-moldova-sofia'], 'moldova-sofia');

            if (dateSelect.value === 'friday') {
                routeSelect.add(optSofia);
            } else {
                routeSelect.add(optMoldova);
            }
        }
    </script>
</body>
</html>