<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EuroTrans - –†–µ–∑–µ—Ä–≤–∞—Ü–∏—è</title>
    <link rel="icon" type="image/png" href="favicon.png">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">

    <style>
        /* --- –°–¢–ò–õ–û–í–ï –ó–ê –ú–û–î–ê–õ–ù–ò–Ø –ü–†–û–ó–û–†–ï–¶ –ò –ë–£–°–ê --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; justify-content: center; align-items: flex-end;
            z-index: 2000; backdrop-filter: blur(3px);
        }
        .modal-overlay.active { display: flex; }

        .modal-content {
            background: white; padding: 20px; border-radius: 20px 20px 0 0;
            width: 100%; max-width: 450px; text-align: center;
            animation: slideUp 0.3s ease-out; max-height: 90vh; overflow-y: auto;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* --- –î–ò–ó–ê–ô–ù –ù–ê MERCEDES V-CLASS --- */
        .v-class-body {
            background: #f3f4f6; border: 4px solid #1f2937;
            border-radius: 40px 40px 15px 15px; padding: 50px 20px 20px 20px;
            margin: 10px auto; width: 180px; position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .v-class-body::before {
            content: ''; position: absolute; top: 15px; left: 20px; right: 20px; height: 30px;
            background: linear-gradient(180deg, #374151 0%, #111827 100%); border-radius: 10px;
        }

        .seat-row { display: flex; justify-content: space-between; margin-bottom: 25px; }
        .seat-row.middle { justify-content: center; gap: 10px; }

        .seat {
            width: 40px; height: 45px; background: white; border: 1px solid #ccc;
            border-radius: 8px; display: flex; justify-content: center; align-items: center;
            cursor: pointer; font-weight: bold; color: #555; position: relative;
            box-shadow: 0 3px 0 #ddd; transition: 0.2s;
        }
        .seat::before { content: ''; position: absolute; top: -6px; width: 26px; height: 5px; background: #ccc; border-radius: 4px; }
        .seat:hover { background: #f9fafb; transform: translateY(-2px); }
        
        .seat.selected { background: #3b82f6; color: white; border-color: #2563eb; box-shadow: 0 3px 0 #1d4ed8; }
        .seat.selected::before { background: #93c5fd; }
        
        .seat.taken { background: #fee2e2; color: #ef4444; border-color: #fca5a5; cursor: not-allowed; box-shadow: none; }
        .seat.taken::before { background: #fca5a5; }

        .seat.driver { background: #374151; color: #9ca3af; border-color: #1f2937; cursor: default; }
        .seat.driver::before { background: #4b5563; }

        .custom-date-input {
            width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px;
            font-size: 16px; background-color: white !important; cursor: pointer; margin-top: 5px;
        }

        .btn-full { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px; }
        .btn-green { background: #22c55e; color: white; }
        .btn-green:hover { background: #16a34a; }
        
        .lang-select { padding: 5px; border-radius: 5px; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <header>
        <div class="nav-container">
            <a href="index.html"><img src="FIP.jpg" alt="Logo" class="logo-img"></a>
            <nav>
                <ul>
                    <li><a href="index.html" id="nav-home">–ù–∞—á–∞–ª–æ</a></li>
                    <li><a href="schedule.html" id="nav-schedule">–†–∞–∑–ø–∏—Å–∞–Ω–∏–µ</a></li>
                    <li><a href="routes.html" id="nav-routes">–ú–∞—Ä—à—Ä—É—Ç–∏</a></li>
                    <li><a href="documents.html" id="nav-docs">–î–æ–∫—É–º–µ–Ω—Ç–∏</a></li>
                    <li><a href="fleet.html" id="nav-fleet">–ê–≤—Ç–æ–ø–∞—Ä–∫</a></li>
                    <li><a href="contact.html" id="nav-contact">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
                    <li>
                        <select class="lang-select" onchange="changeLanguage(this.value)">
                            <option value="bg">üáßüá¨</option>
                            <option value="en">üá¨üáß</option>
                            <option value="ru">üá∑üá∫</option>
                            <option value="ua">üá∫üá¶</option>
                        </select>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title" id="page-title" style="text-align: center; margin: 30px 0;">–°–≤—ä—Ä–∂–µ—Ç–µ —Å–µ —Å –Ω–∞—Å</h1>
        
        <div class="grid" style="grid-template-columns: 1fr 1.5fr; gap: 30px;">
            
            <div class="card">
                <h3 id="info-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <p>üìû <strong>BG:</strong> +359 888 123 456</p>
                <p>üìû <strong>MD:</strong> +373 69 123 456</p>
                <br>
                <p>üìß office@eurotrans.com</p>
                <p id="info-addr">üìç –°–æ—Ñ–∏—è, –ë—ä–ª–≥–∞—Ä–∏—è</p>
            </div>

            <div class="content-box">
                <h2 id="form-title">–†–µ–∑–µ—Ä–≤–∞—Ü–∏—è –Ω–∞ –º—è—Å—Ç–æ</h2>
                
                <form id="booking-form">
                    
                    <div style="margin-bottom: 15px;">
                        <label id="lbl-name">–ò–º–µ –∏ –§–∞–º–∏–ª–∏—è</label>
                        <input type="text" id="name" style="width: 100%; padding: 10px; border:1px solid #ccc; border-radius:5px;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label id="lbl-email">Email</label>
                        <input type="email" id="email" style="width: 100%; padding: 10px; border:1px solid #ccc; border-radius:5px;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label id="lbl-phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="text" id="phone" style="width: 100%; padding: 10px; border:1px solid #ccc; border-radius:5px;" required>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label id="lbl-route">–ú–∞—Ä—à—Ä—É—Ç</label>
                        <select id="route" style="width: 100%; padding: 10px; border:1px solid #ccc; border-radius:5px;" onchange="initDates()">
                            <option value="sofia-moldova" id="opt-sofia-moldova">–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞ (–ü–µ—Ç—ä–∫)</option>
                            <option value="moldova-sofia" id="opt-moldova-sofia">–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è (–ù–µ–¥–µ–ª—è)</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label id="lbl-date">–î–∞—Ç–∞ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ</label>
                        <input type="text" id="travel-date" class="custom-date-input" placeholder="üìÖ –ò–∑–±–µ—Ä–µ—Ç–µ –¥–∞—Ç–∞..." readonly>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label id="lbl-message">–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
                        <textarea id="message" rows="2" style="width: 100%; padding: 10px; border:1px solid #ccc; border-radius:5px;"></textarea>
                    </div>

                    <button type="button" onclick="openSeatMap()" class="btn-full btn-green" id="btn-choose-seat">üöç –ò–∑–±–µ—Ä–∏ –º—è—Å—Ç–æ</button>
                </form>
            </div>
        </div>
    </main>

    <div id="seat-modal" class="modal-overlay" onclick="if(event.target === this) closeSeatMap()">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 id="modal-title" style="margin:0;">Mercedes V-Class</h3>
                <button onclick="closeSeatMap()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            
            <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; font-size: 0.9em;">
                <span id="legend-free">‚ö™ –°–≤–æ–±–æ–¥–Ω–æ</span>
                <span id="legend-taken" style="color:#ef4444">üî¥ –ó–∞–µ—Ç–æ</span>
                <span id="legend-your" style="color:#2563eb">üîµ –í–∞—à–µ—Ç–æ</span>
            </div>

            <div class="v-class-body">
                <div class="seat-row">
                    <div class="seat driver"><i class="fas fa-steering-wheel"></i></div>
                    <div class="seat" data-seat="1" onclick="selectSeat(1)">1</div>
                </div>
                <div style="height: 20px;"></div>
                <div class="seat-row middle">
                    <div class="seat" data-seat="2" onclick="selectSeat(2)">2</div>
                    <div class="seat" data-seat="3" onclick="selectSeat(3)">3</div>
                    <div class="seat" data-seat="4" onclick="selectSeat(4)">4</div>
                </div>
                <div style="height: 20px;"></div>
                <div class="seat-row middle">
                    <div class="seat" data-seat="5" onclick="selectSeat(5)">5</div>
                    <div class="seat" data-seat="6" onclick="selectSeat(6)">6</div>
                    <div class="seat" data-seat="7" onclick="selectSeat(7)">7</div>
                </div>
            </div>

            <p id="selected-seat-msg" style="font-weight: bold; color: #2563eb; min-height: 20px;">...</p>
            <button id="btn-confirm-booking" class="btn-full btn-green" onclick="finalizeBooking()" disabled>‚úÖ –ü–æ—Ç–≤—ä—Ä–¥–∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è—Ç–∞</button>
        </div>
    </div>

    <footer>
        <p id="footer-text">&copy; FIP –í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/bg.js"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ru.js"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/uk.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        // --- 1. –ü–†–ï–í–û–î–ò (–ü–™–õ–ï–ù –°–ü–ò–°–™–ö) ---
        const translations = {
            'bg': {
                'nav-home': '–ù–∞—á–∞–ª–æ', 'nav-schedule': '–†–∞–∑–ø–∏—Å–∞–Ω–∏–µ', 'nav-routes': '–ú–∞—Ä—à—Ä—É—Ç–∏', 'nav-docs': '–î–æ–∫—É–º–µ–Ω—Ç–∏', 'nav-fleet': '–ê–≤—Ç–æ–ø–∞—Ä–∫', 'nav-contact': '–ö–æ–Ω—Ç–∞–∫—Ç–∏',
                'page-title': '–°–≤—ä—Ä–∂–µ—Ç–µ —Å–µ —Å –Ω–∞—Å',
                'info-title': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                'info-addr': 'üìç –°–æ—Ñ–∏—è, –ë—ä–ª–≥–∞—Ä–∏—è',
                'form-title': '–†–µ–∑–µ—Ä–≤–∞—Ü–∏—è –Ω–∞ –º—è—Å—Ç–æ',
                'lbl-name': '–ò–º–µ –∏ –§–∞–º–∏–ª–∏—è',
                'lbl-email': 'Email',
                'lbl-phone': '–¢–µ–ª–µ—Ñ–æ–Ω',
                'lbl-route': '–ú–∞—Ä—à—Ä—É—Ç',
                'lbl-date': '–î–∞—Ç–∞ –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–µ',
                'lbl-message': '–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                'btn-choose-seat': 'üöç –ò–∑–±–µ—Ä–∏ –º—è—Å—Ç–æ',
                'opt-sofia-moldova': '–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞ (–ü–µ—Ç—ä–∫)',
                'opt-moldova-sofia': '–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è (–ù–µ–¥–µ–ª—è)',
                'modal-title': 'Mercedes V-Class',
                'legend-free': '‚ö™ –°–≤–æ–±–æ–¥–Ω–æ',
                'legend-taken': 'üî¥ –ó–∞–µ—Ç–æ',
                'legend-your': 'üîµ –í–∞—à–µ—Ç–æ',
                'btn-confirm-booking': '‚úÖ –ü–æ—Ç–≤—ä—Ä–¥–∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è—Ç–∞',
                'msg-seat-select': '–ú—è—Å—Ç–æ: ',
                'msg-choose-first': '–ú–æ–ª—è –∏–∑–±–µ—Ä–µ—Ç–µ –º—è—Å—Ç–æ',
                'alert-fill': '–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!',
                'alert-success': '–†–µ–∑–µ—Ä–≤–∞—Ü–∏—è—Ç–∞ –µ —É—Å–ø–µ—à–Ω–∞!',
                'placeholder-date': 'üìÖ –ò–∑–±–µ—Ä–µ—Ç–µ –¥–∞—Ç–∞...'
            },
            'en': {
                'nav-home': 'Home', 'nav-schedule': 'Schedule', 'nav-routes': 'Routes', 'nav-docs': 'Documents', 'nav-fleet': 'Fleet', 'nav-contact': 'Contact',
                'page-title': 'Contact Us',
                'info-title': 'Information',
                'info-addr': 'üìç Sofia, Bulgaria',
                'form-title': 'Seat Booking',
                'lbl-name': 'Full Name',
                'lbl-email': 'Email',
                'lbl-phone': 'Phone Number',
                'lbl-route': 'Route',
                'lbl-date': 'Travel Date',
                'lbl-message': 'Additional Info',
                'btn-choose-seat': 'üöç Choose Seat',
                'opt-sofia-moldova': 'Sofia ‚ûî Moldova (Friday)',
                'opt-moldova-sofia': 'Moldova ‚ûî Sofia (Sunday)',
                'modal-title': 'Mercedes V-Class',
                'legend-free': '‚ö™ Free',
                'legend-taken': 'üî¥ Taken',
                'legend-your': 'üîµ Yours',
                'btn-confirm-booking': '‚úÖ Confirm Booking',
                'msg-seat-select': 'Seat: ',
                'msg-choose-first': 'Please select a seat',
                'alert-fill': 'Please fill all fields!',
                'alert-success': 'Booking Successful!',
                'placeholder-date': 'üìÖ Select date...'
            },
            'ru': {
                'nav-home': '–ì–ª–∞–≤–Ω–∞—è', 'nav-schedule': '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ', 'nav-routes': '–ú–∞—Ä—à—Ä—É—Ç—ã', 'nav-docs': '–î–æ–∫—É–º–µ–Ω—Ç—ã', 'nav-fleet': '–ê–≤—Ç–æ–ø–∞—Ä–∫', 'nav-contact': '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
                'page-title': '–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏',
                'info-title': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                'info-addr': 'üìç –°–æ—Ñ–∏—è, –ë–æ–ª–≥–∞—Ä–∏—è',
                'form-title': '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞',
                'lbl-name': '–ò–º—è –∏ –§–∞–º–∏–ª–∏—è',
                'lbl-email': 'Email',
                'lbl-phone': '–¢–µ–ª–µ—Ñ–æ–Ω',
                'lbl-route': '–ú–∞—Ä—à—Ä—É—Ç',
                'lbl-date': '–î–∞—Ç–∞ –ø–æ–µ–∑–¥–∫–∏',
                'lbl-message': '–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                'btn-choose-seat': 'üöç –í—ã–±—Ä–∞—Ç—å –º–µ—Å—Ç–æ',
                'opt-sofia-moldova': '–°–æ—Ñ–∏—è ‚ûî –ú–æ–ª–¥–æ–≤–∞ (–ü—è—Ç–Ω–∏—Ü–∞)',
                'opt-moldova-sofia': '–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ–∏—è (–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)',
                'modal-title': 'Mercedes V-Class',
                'legend-free': '‚ö™ –°–≤–æ–±–æ–¥–Ω–æ',
                'legend-taken': 'üî¥ –ó–∞–Ω—è—Ç–æ',
                'legend-your': 'üîµ –í–∞—à–µ',
                'btn-confirm-booking': '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å',
                'msg-seat-select': '–ú–µ—Å—Ç–æ: ',
                'msg-choose-first': '–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ',
                'alert-fill': '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!',
                'alert-success': '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!',
                'placeholder-date': 'üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É...'
            },
            'ua': {
                'nav-home': '–ì–æ–ª–æ–≤–Ω–∞', 'nav-schedule': '–†–æ–∑–∫–ª–∞–¥', 'nav-routes': '–ú–∞—Ä—à—Ä—É—Ç–∏', 'nav-docs': '–î–æ–∫—É–º–µ–Ω—Ç–∏', 'nav-fleet': '–ê–≤—Ç–æ–ø–∞—Ä–∫', 'nav-contact': '–ö–æ–Ω—Ç–∞–∫—Ç–∏',
                'page-title': '–ó–≤\'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏',
                'info-title': '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è',
                'info-addr': 'üìç –°–æ—Ñ—ñ—è, –ë–æ–ª–≥–∞—Ä—ñ—è',
                'form-title': '–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –º—ñ—Å—Ü—è',
                'lbl-name': '–Ü–º\'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ',
                'lbl-email': 'Email',
                'lbl-phone': '–¢–µ–ª–µ—Ñ–æ–Ω',
                'lbl-route': '–ú–∞—Ä—à—Ä—É—Ç',
                'lbl-date': '–î–∞—Ç–∞ –ø–æ–¥–æ—Ä–æ–∂—ñ',
                'lbl-message': '–î–æ–¥. —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è',
                'btn-choose-seat': 'üöç –û–±—Ä–∞—Ç–∏ –º—ñ—Å—Ü–µ',
                'opt-sofia-moldova': '–°–æ—Ñ—ñ—è ‚ûî –ú–æ–ª–¥–æ–≤–∞ (–ü\'—è—Ç–Ω–∏—Ü—è)',
                'opt-moldova-sofia': '–ú–æ–ª–¥–æ–≤–∞ ‚ûî –°–æ—Ñ—ñ—è (–ù–µ–¥—ñ–ª—è)',
                'modal-title': 'Mercedes V-Class',
                'legend-free': '‚ö™ –í—ñ–ª—å–Ω–µ',
                'legend-taken': 'üî¥ –ó–∞–π–Ω—è—Ç–æ',
                'legend-your': 'üîµ –í–∞—à–µ',
                'btn-confirm-booking': '‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏',
                'msg-seat-select': '–ú—ñ—Å—Ü–µ: ',
                'msg-choose-first': '–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ü–µ',
                'alert-fill': '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!',
                'alert-success': '–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–µ!',
                'placeholder-date': 'üìÖ –û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É...'
            }
        };

        // --- 2. FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBGEPxa0rGPyByiY8Tp3GaiflGnApQocgU",
            authDomain: "prevozmoldovabulgaria.firebaseapp.com",
            projectId: "prevozmoldovabulgaria",
            storageBucket: "prevozmoldovabulgaria.firebasestorage.app",
            messagingSenderId: "970743272899",
            appId: "1:970743272899:web:c27df38bd186bd7e7a1976",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let currentLang = 'bg';
        let calendarInstance = null;
        let selectedSeatNum = null;

        // --- 3. –§–£–ù–ö–¶–ò–Ø –ó–ê –°–ú–Ø–ù–ê –ù–ê –ï–ó–ò–ö–ê ---
        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            // 1. –°–º—è–Ω–∞ –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–µ—Ç–µ –ø–æ ID
            for (const key in t) {
                const el = document.getElementById(key);
                if (el) {
                    // –ê–∫–æ –µ input/textarea —Å placeholder, —Å–º–µ–Ω—è–º–µ placeholder-–∞
                    if (key === 'placeholder-date') {
                        document.getElementById('travel-date').placeholder = t[key];
                    } else {
                        // –ò–Ω–∞—á–µ —Å–º–µ–Ω—è–º–µ —Ç–µ–∫—Å—Ç–∞
                        el.innerText = t[key];
                    }
                }
            }

            // 2. –°–º—è–Ω–∞ –Ω–∞ dropdown –æ–ø—Ü–∏–∏—Ç–µ —Ä—ä—á–Ω–æ (–∑–∞ –≤—Å–µ–∫–∏ —Å–ª—É—á–∞–π)
            const opt1 = document.getElementById('opt-sofia-moldova');
            const opt2 = document.getElementById('opt-moldova-sofia');
            if(opt1) opt1.innerText = t['opt-sofia-moldova'];
            if(opt2) opt2.innerText = t['opt-moldova-sofia'];

            // 3. –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ –∑–∞ –∏–∑–±—Ä–∞–Ω–æ –º—è—Å—Ç–æ (–∞–∫–æ –∏–º–∞ –∏–∑–±—Ä–∞–Ω–æ)
            updateSeatUI();

            // 4. –†–µ—Å—Ç–∞—Ä—Ç –Ω–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä–∞ —Å –Ω–æ–≤–∏—è –µ–∑–∏–∫
            initDates();

            // 5. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ —Å–µ–ª–µ–∫—Ç–∏ –∑–∞ –µ–∑–∏–∫
            document.querySelectorAll('.lang-select').forEach(s => s.value = lang);
        }

        // --- 4. –ö–ê–õ–ï–ù–î–ê–† (FLATPICKR) ---
        function initDates() {
            const route = document.getElementById('route').value;
            const dateInput = document.getElementById('travel-date');
            
            // –ê–∫–æ –≤–µ—á–µ –∏–º–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç, —è –∑–∞–ø–∞–∑–≤–∞–º–µ –≤—Ä–µ–º–µ–Ω–Ω–æ (–ø–æ –∂–µ–ª–∞–Ω–∏–µ), –Ω–æ —Ç—É–∫ —è —á–∏—Å—Ç–∏–º –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç
            const oldDate = dateInput.value; 
            
            if (calendarInstance) calendarInstance.destroy();

            // –õ–æ–∫–∞–ª –∑–∞ Flatpickr (bg, ru, uk(za ukrainian), default=en)
            let localeCode = 'default';
            if(currentLang === 'bg') localeCode = 'bg';
            if(currentLang === 'ru') localeCode = 'ru';
            if(currentLang === 'ua') localeCode = 'uk'; // Flatpickr –ø–æ–ª–∑–≤–∞ 'uk' –∑–∞ —É–∫—Ä–∞–∏–Ω—Å–∫–∏

            let allowedDay = (route === 'sofia-moldova') ? 5 : 0; // 5=–ü–µ—Ç—ä–∫, 0=–ù–µ–¥–µ–ª—è

            calendarInstance = flatpickr("#travel-date", {
                locale: localeCode,
                dateFormat: "d.m.Y",
                minDate: "today",
                disableMobile: "true",
                defaultDate: oldDate, // –û–ø–∏—Ç–≤–∞–º–µ —Å–µ –¥–∞ –∑–∞–ø–∞–∑–∏–º –¥–∞—Ç–∞—Ç–∞ –∞–∫–æ –µ –≤–∞–ª–∏–¥–Ω–∞
                enable: [
                    function(date) { return (date.getDay() === allowedDay); }
                ]
            });
        }

        // --- 5. –§–£–ù–ö–¶–ò–Ø –ó–ê –ó–ê–©–ò–¢–ê (COOLDOWN) 30 –ú–ò–ù–£–¢–ò ---
        function checkCooldown() {
            const cooldown = localStorage.getItem('bookingCooldown');
            if (cooldown) {
                const now = new Date().getTime();
                const diff = cooldown - now;

                if (diff > 0) {
                    const minutesLeft = Math.ceil(diff / 60000);
                    alert("–ú–æ–ª—è –∏–∑—á–∞–∫–∞–π—Ç–µ " + minutesLeft + " –º–∏–Ω—É—Ç–∏ –ø—Ä–µ–¥–∏ –Ω–æ–≤–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è.");
                    return true; // –ò–º–∞ –∞–∫—Ç–∏–≤–µ–Ω –∫—É–ª–¥–∞—É–Ω
                } else {
                    localStorage.removeItem('bookingCooldown');
                    return false; // –ö—É–ª–¥–∞—É–Ω—ä—Ç –µ –∏–∑—Ç–µ–∫—ä–ª
                }
            }
            return false; // –ù—è–º–∞ –∫—É–ª–¥–∞—É–Ω
        }

        // --- 6. –õ–û–ì–ò–ö–ê –ó–ê –ú–ï–°–¢–ê–¢–ê ---
        function openSeatMap() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ Cooldown –ø—Ä–µ–¥–∏ –¥–∞ –æ—Ç–≤–æ—Ä–∏–º –∫–∞—Ä—Ç–∞—Ç–∞
            if (checkCooldown()) return;

            const t = translations[currentLang];
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const date = document.getElementById('travel-date').value;

            if(!name || !phone || !date) {
                alert(t['alert-fill']);
                return;
            }

            document.getElementById('seat-modal').classList.add('active');
            selectedSeatNum = null;
            updateSeatUI();
            loadTakenSeats(date);
        }

        function closeSeatMap() {
            document.getElementById('seat-modal').classList.remove('active');
        }

        function loadTakenSeats(date) {
            document.querySelectorAll('.seat').forEach(s => {
                if(!s.classList.contains('driver')) s.className = 'seat';
            });

            const route = document.getElementById('route').value;
            db.collection("reservations")
              .where("date", "==", date)
              .where("route", "==", route)
              .get()
              .then((snapshot) => {
                  snapshot.forEach((doc) => {
                      const data = doc.data();
                      if (data.seatNumber) {
                          const el = document.querySelector(`.seat[data-seat="${data.seatNumber}"]`);
                          if(el) el.classList.add('taken');
                      }
                  });
              });
        }

        function selectSeat(num) {
            const el = document.querySelector(`.seat[data-seat="${num}"]`);
            if(el.classList.contains('taken')) return;

            document.querySelectorAll('.seat.selected').forEach(s => s.classList.remove('selected'));
            el.classList.add('selected');
            selectedSeatNum = num;
            updateSeatUI();
        }

        function updateSeatUI() {
            const t = translations[currentLang];
            const msg = document.getElementById('selected-seat-msg');
            const btn = document.getElementById('btn-confirm-booking');

            if(selectedSeatNum) {
                msg.innerText = t['msg-seat-select'] + selectedSeatNum;
                btn.disabled = false;
            } else {
                msg.innerText = t['msg-choose-first'];
                btn.disabled = true;
            }
        }

        // --- 7. –ó–ê–ü–ê–ó–í–ê–ù–ï ---
        function finalizeBooking() {
            // –û—â–µ –µ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç –ø—Ä–µ–¥–∏ –∏–∑–ø—Ä–∞—â–∞–Ω–µ
            if (checkCooldown()) return;

            const t = translations[currentLang];
            const btn = document.getElementById('btn-confirm-booking');
            btn.disabled = true;

            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                route: document.getElementById('route').value,
                date: document.getElementById('travel-date').value,
                message: document.getElementById('message').value,
                seatNumber: selectedSeatNum,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            db.collection("reservations").add(formData)
            .then(() => {
                // –¢–£–ö –ê–ö–¢–ò–í–ò–†–ê–ú–ï –ö–£–õ–î–ê–£–ù–ê –ó–ê 30 –ú–ò–ù–£–¢–ò
                const cooldownTime = new Date().getTime() + (30 * 60 * 1000);
                localStorage.setItem('bookingCooldown', cooldownTime);

                alert(t['alert-success']);
                location.reload();
            })
            .catch((error) => {
                alert("Error: " + error.message);
                btn.disabled = false;
            });
        }

        // –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
        window.addEventListener('DOMContentLoaded', () => {
            changeLanguage('bg'); // –°—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ –Ω–∞ –ë–ì
        });
    </script>
</body>
</html>