<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EuroTrans - –ú–∞—Ä—à—Ä—É—Ç–∏</title>
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
</head>
<body>
    <header>
        <div class="container nav-container">
            <a href="index.html" class="logo">EuroTrans</a>
            <nav>
                <ul>
                    <li><a href="index.html" id="nav-home">–ù–∞—á–∞–ª–æ</a></li>
                    <li><a href="routes.html" class="active" id="nav-routes">–ú–∞—Ä—à—Ä—É—Ç–∏</a></li>
                    <li><a href="schedule.html" id="nav-schedule">–†–∞–∑–ø–∏—Å–∞–Ω–∏–µ</a></li>
                    <li><a href="fleet.html" id="nav-fleet">–ê–≤—Ç–æ–ø–∞—Ä–∫</a></li>
                    <li><a href="contact.html" id="nav-contact">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
                    <li>
                        <select class="lang-select" onchange="changeLanguage(this.value)">
                            <option value="bg">üáßüá¨ BG</option>
                            <option value="en">üá¨üáß EN</option>
                            <option value="ru">üá∑üá∫ RU</option>
                            <option value="ua">üá∫üá¶ UA</option>
                        </select>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title" id="routes-title">–ü–ª–∞–Ω–∏—Ä–∞–π—Ç–µ —Å–≤–æ—è –º–∞—Ä—à—Ä—É—Ç</h1>

        <div class="route-controls">
            <div class="route-toggles">
                <button class="route-toggle-btn active" onclick="setDirection('bg-md')" id="btn-bg-md">üáßüá¨ –°–æ—Ñ–∏—è ‚ûî üá≤üá© –ú–æ–ª–¥–æ–≤–∞</button>
                <button class="route-toggle-btn" onclick="setDirection('md-bg')" id="btn-md-bg">üá≤üá© –ú–æ–ª–¥–æ–≤–∞ ‚ûî üáßüá¨ –°–æ—Ñ–∏—è</button>
            </div>

            <div class="route-options">
                <p id="route-instruction">–ò–∑–±–µ—Ä–µ—Ç–µ –º–µ–∂–¥–∏–Ω–Ω–∏ —Å–ø–∏—Ä–∫–∏:</p>
                
                <div id="select-container" style="display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; align-items: center;">
                    
                    <span class="static-city" id="city-sofia">–°–æ—Ñ–∏—è</span>
                    <span>‚ûù</span>
                    
                    <select id="bg-stop" onchange="updateMap()">
                        <option value="none" id="opt-none">-- –î–∏—Ä–µ–∫—Ç–Ω–æ --</option>
                        <option value="stara_zagora" id="opt-sz">–°—Ç–∞—Ä–∞ –ó–∞–≥–æ—Ä–∞</option>
                        <option value="varna" id="opt-varna">–í–∞—Ä–Ω–∞</option>
                        <option value="burgas" id="opt-burgas">–ë—É—Ä–≥–∞—Å</option>
                    </select>
                    
                    <span>‚ûù</span>
                    <span class="static-city">–†—É—Å–µ</span>
                    <span>‚ûù</span>
                    <span class="static-city">–ì–∞–ª–∞—Ü</span>
                    <span>‚ûù</span>
                    <span class="static-city">–ß–∞–¥—ä—Ä-–õ—É–Ω–≥–∞</span>
                    <span>‚ûù</span>

                    <select id="md-stop" onchange="updateMap()">
                        <option value="none" id="opt-none-2">-- –î–∏—Ä–µ–∫—Ç–Ω–æ --</option>
                        <option value="chisinau" id="opt-chisinau">–ö–∏—à–∏–Ω–µ–≤</option>
                        <option value="tvarditsa" id="opt-tvarditsa">–¢–≤–∞—Ä–¥–∏—Ü–∞</option>
                    </select>
                </div>
            </div>

            <div id="map"></div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <a href="contact.html" class="btn" id="btn-contact-route">–ó–∞–ø–∞–∑–∏ –ø—ä—Ç—É–≤–∞–Ω–µ</a>
        </div>
    </main>

    <script type="module" src="auth.js"></script>
    <script src="lang.js"></script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –Ω–∞ –≥—Ä–∞–¥–æ–≤–µ—Ç–µ
        const coords = {
            sofia: [42.6977, 23.3219],
            stara_zagora: [42.4258, 25.6345],
            varna: [43.2141, 27.9147],
            burgas: [42.5048, 27.4626],
            ruse: [43.8356, 25.9657],
            galati: [45.4353, 28.0080],
            ceadir: [46.0569, 28.8315],
            chisinau: [47.0105, 28.8638],
            tvarditsa: [46.1517, 28.9667]
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞
        var map = L.map('map').setView([44.5, 26.0], 6);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var currentPolyline = null;
        var markers = [];

        function clearMap() {
            if (currentPolyline) map.removeLayer(currentPolyline);
            markers.forEach(m => map.removeLayer(m));
            markers = [];
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞
        function updateMap() {
            clearMap();

            const bgStop = document.getElementById('bg-stop').value;
            const mdStop = document.getElementById('md-stop').value;
            const direction = document.querySelector('.route-toggle-btn.active').id;

            // –ë–∞–∑–æ–≤ –º–∞—Ä—à—Ä—É—Ç
            let path = [];
            let names = [];

            // –û–ø—Ä–µ–¥–µ–ª—è–Ω–µ –Ω–∞ —Ä–µ–¥–∞ —Å–ø–æ—Ä–µ–¥ –ø–æ—Å–æ–∫–∞—Ç–∞
            if (direction === 'btn-bg-md') {
                // –°–æ—Ñ–∏—è -> –ú–æ–ª–¥–æ–≤–∞
                path.push(coords.sofia); names.push("–°–æ—Ñ–∏—è");
                
                if (bgStop !== 'none') { path.push(coords[bgStop]); names.push(bgStop); }
                
                path.push(coords.ruse); names.push("–†—É—Å–µ");
                path.push(coords.galati); names.push("–ì–∞–ª–∞—Ü");
                path.push(coords.ceadir); names.push("–ß–∞–¥—ä—Ä-–õ—É–Ω–≥–∞");

                if (mdStop !== 'none') { path.push(coords[mdStop]); names.push(mdStop); }
            
            } else {
                // –ú–æ–ª–¥–æ–≤–∞ -> –°–æ—Ñ–∏—è
                if (mdStop !== 'none') { path.push(coords[mdStop]); names.push(mdStop); }
                
                path.push(coords.ceadir); names.push("–ß–∞–¥—ä—Ä-–õ—É–Ω–≥–∞");
                path.push(coords.galati); names.push("–ì–∞–ª–∞—Ü");
                path.push(coords.ruse); names.push("–†—É—Å–µ");

                if (bgStop !== 'none') { path.push(coords[bgStop]); names.push(bgStop); }
                
                path.push(coords.sofia); names.push("–°–æ—Ñ–∏—è");
            }

            // –†–∏—Å—É–≤–∞–Ω–µ –Ω–∞ –ª–∏–Ω–∏—è—Ç–∞
            currentPolyline = L.polyline(path, {color: 'blue', weight: 4}).addTo(map);
            
            // –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä–∏
            path.forEach((point, index) => {
                let marker = L.marker(point).addTo(map)
                    .bindPopup(`–°–ø–∏—Ä–∫–∞ ${index + 1}`);
                markers.push(marker);
            });

            // –¶–µ–Ω—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞
            map.fitBounds(currentPolyline.getBounds(), {padding: [50, 50]});
        }

        function setDirection(dir) {
            const btnBgMd = document.getElementById('btn-bg-md');
            const btnMdBg = document.getElementById('btn-md-bg');
            const container = document.getElementById('select-container');

            if (dir === 'bg-md') {
                btnBgMd.classList.add('active');
                btnMdBg.classList.remove('active');
                // –ü–æ–¥—Ä–µ–¥–∏ –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ –Ω–æ—Ä–º–∞–ª–Ω–æ (–°–æ—Ñ–∏—è –ø—ä—Ä–≤–∞)
                // –ó–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–º–µ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –≤–∏–∑—É–∞–ª–Ω–æ —á—Ä–µ–∑ CSS order –∏–ª–∏ JS
                // –¢—É–∫ –ø—Ä–æ—Å—Ç–æ —â–µ –∏–∑–≤–∏–∫–∞–º–µ updateMap, —Ç—ä–π –∫–∞—Ç–æ –ª–æ–≥–∏–∫–∞—Ç–∞ –µ –≤—ä—Ç—Ä–µ
            } else {
                btnBgMd.classList.remove('active');
                btnMdBg.classList.add('active');
            }
            updateMap();
        }

        // –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
        updateMap();
    </script>
</body>
</html>