<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>EuroTrans - –ú–∞—Ä—à—Ä—É—Ç–∏</title>
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    
    <style>
        #map { height: 500px; width: 100%; border-radius: 10px; margin-top: 20px; z-index: 1; }
        .route-controls { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .leaflet-routing-container { display: none !important; } /* –°–∫—Ä–∏–≤–∞–º–µ —Ç–µ–∫—Å—Ç–æ–≤–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
    </style>
</head>
<body>
    <header>
        <div class="nav-container">
            <a href="index.html"><img src="FIP.jpg" alt="EuroTrans Logo" class="logo-img"></a>
            <nav>
                <ul>
                    <li><a href="index.html" id="nav-home">–ù–∞—á–∞–ª–æ</a></li>
                    <li><a href="routes.html" class="active" id="nav-routes">–ú–∞—Ä—à—Ä—É—Ç–∏</a></li>
                    <li><a href="schedule.html" id="nav-schedule">–†–∞–∑–ø–∏—Å–∞–Ω–∏–µ</a></li>
                    <li><a href="fleet.html" id="nav-fleet">–ê–≤—Ç–æ–ø–∞—Ä–∫</a></li>
                    <li><a href="contact.html" id="nav-contact">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
                    <li><select class="lang-select" onchange="changeLanguage(this.value)"><option value="bg">üáßüá¨</option><option value="en">üá¨üáß</option><option value="ru">üá∑üá∫</option><option value="ua">üá∫üá¶</option></select></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title" id="routes-title">–ü–ª–∞–Ω–∏—Ä–∞–π—Ç–µ —Å–≤–æ—è –º–∞—Ä—à—Ä—É—Ç</h1>

        <div class="route-controls">
            <div style="margin-bottom: 15px;">
                <button class="btn" style="background:var(--bg-card); color:white;" onclick="setDirection('bg-md')" id="btn-bg-md">üáßüá¨ –°–æ—Ñ–∏—è ‚ûî üá≤üá© –ú–æ–ª–¥–æ–≤–∞</button>
                <button class="btn" style="background:#fff; color:#333; border:1px solid #ccc;" onclick="setDirection('md-bg')" id="btn-md-bg">üá≤üá© –ú–æ–ª–¥–æ–≤–∞ ‚ûî üáßüá¨ –°–æ—Ñ–∏—è</button>
            </div>
            
            <div id="select-container" style="display:flex; justify-content:center; gap:10px; align-items:center; flex-wrap:wrap;">
                <span class="static-city" id="city-sofia">–°–æ—Ñ–∏—è</span> ‚ûù
                <select id="bg-stop" onchange="updateMap()"><option value="none">-- –î–∏—Ä–µ–∫—Ç–Ω–æ --</option><option value="stara_zagora">–°—Ç–∞—Ä–∞ –ó–∞–≥–æ—Ä–∞</option><option value="varna">–í–∞—Ä–Ω–∞</option><option value="burgas">–ë—É—Ä–≥–∞—Å</option></select> ‚ûù
                <span>–†—É—Å–µ</span> ‚ûù <span>–ì–∞–ª–∞—Ü</span> ‚ûù <span>–ß–∞–¥—ä—Ä-–õ—É–Ω–≥–∞</span> ‚ûù
                <select id="md-stop" onchange="updateMap()"><option value="none">-- –î–∏—Ä–µ–∫—Ç–Ω–æ --</option><option value="chisinau">–ö–∏—à–∏–Ω–µ–≤</option><option value="tvarditsa">–¢–≤–∞—Ä–¥–∏—Ü–∞</option></select>
            </div>
        </div>

        <div id="map"></div>
    </main>

    <script type="module" src="auth.js"></script>
    <script src="lang.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

    <script>
        const coords = {
            sofia: [42.6977, 23.3219],
            stara_zagora: [42.4258, 25.6345],
            varna: [43.2141, 27.9147],
            burgas: [42.5048, 27.4626],
            ruse: [43.8356, 25.9657],
            galati: [45.4353, 28.0080],
            ceadir: [46.0569, 28.8315],
            chisinau: [47.0105, 28.8638],
            tvarditsa: [46.1517, 28.9667]
        };

        var map = L.map('map').setView([44.5, 26.0], 6);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

        var routingControl = null;

        function updateMap() {
            if (routingControl) {
                map.removeControl(routingControl);
                routingControl = null;
            }

            const bgStop = document.getElementById('bg-stop').value;
            const mdStop = document.getElementById('md-stop').value;
            const direction = document.getElementById('btn-bg-md').style.background.includes('var(--bg-card)') ? 'bg-md' : 'md-bg'; // Simple check

            let waypoints = [];

            if (direction === 'bg-md' || !direction) { // Default bg-md
                waypoints.push(L.latLng(coords.sofia));
                if (bgStop !== 'none') waypoints.push(L.latLng(coords[bgStop]));
                waypoints.push(L.latLng(coords.ruse));
                waypoints.push(L.latLng(coords.galati));
                waypoints.push(L.latLng(coords.ceadir));
                if (mdStop !== 'none') waypoints.push(L.latLng(coords[mdStop]));
            } else {
                if (mdStop !== 'none') waypoints.push(L.latLng(coords[mdStop]));
                waypoints.push(L.latLng(coords.ceadir));
                waypoints.push(L.latLng(coords.galati));
                waypoints.push(L.latLng(coords.ruse));
                if (bgStop !== 'none') waypoints.push(L.latLng(coords[bgStop]));
                waypoints.push(L.latLng(coords.sofia));
            }

            routingControl = L.Routing.control({
                waypoints: waypoints,
                routeWhileDragging: false,
                draggableWaypoints: false,
                addWaypoints: false,
                show: false, // Hide instructions
                lineOptions: { styles: [{color: '#2563eb', opacity: 1, weight: 5}] },
                createMarker: function(i, wp, nWps) {
                    return L.marker(wp.latLng).bindPopup("–°–ø–∏—Ä–∫–∞ " + (i+1));
                }
            }).addTo(map);
        }

        function setDirection(dir) {
            const btnBg = document.getElementById('btn-bg-md');
            const btnMd = document.getElementById('btn-md-bg');
            if(dir === 'bg-md') {
                btnBg.style.background = 'var(--bg-card)'; btnBg.style.color = 'white';
                btnMd.style.background = '#fff'; btnMd.style.color = '#333';
            } else {
                btnMd.style.background = 'var(--bg-card)'; btnMd.style.color = 'white';
                btnBg.style.background = '#fff'; btnBg.style.color = '#333';
            }
            setTimeout(updateMap, 100);
        }

        updateMap();
    </script>

    <button id="scroll-to-top">‚Üë</button>

    <script>
        let lastScrollTop = 0;
        const header = document.querySelector('header');
        const scrollToTopBtn = document.getElementById('scroll-to-top');

        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if (scrollTop > lastScrollTop && scrollTop > 100) {
                header.classList.add('hidden');
            } else {
                header.classList.remove('hidden');
            }
            lastScrollTop = scrollTop;
            if (scrollTop > 200) {
                scrollToTopBtn.style.display = 'block';
            } else {
                scrollToTopBtn.style.display = 'none';
            }
        });

        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>
</body>
</html>